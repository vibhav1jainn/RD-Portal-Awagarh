<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RD Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    font-family: "Poppins", sans-serif;
    background: #fafafa;
    padding: 20px;
}
.card {
    background: white;
    padding: 20px;
    margin-top: 20px;
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
}
h2 { color: #b30000; }
</style>

</head>
<body>

<h1>Customer RD Dashboard</h1>

<div class="card">
    <h2 id="name"></h2>
    <p><b>Mobile:</b> <span id="mobile"></span></p>
    <p><b>Start Date:</b> <span id="start_date"></span></p>
    <p><b>Maturity Date:</b> <span id="maturity_date"></span></p>
    <p><b>Monthly Amount:</b> ₹<span id="amount"></span></p>
    <p><b>Total Deposited:</b> ₹<span id="total"></span></p>
    <p><b>Remaining:</b> ₹<span id="remaining"></span></p>
    <p><b>Maturity Amount:</b> ₹<span id="maturity_amount"></span></p>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
    // Your Firebase Config (Keep this as is)
    apiKey: "AIzaSyCY-C3WW3-a0c7Z384Lm2uBjMQMCFhqcGU",
    authDomain: "rd-portal-awagarh-be498.firebaseapp.com",
    projectId: "rd-portal-awagarh-be498",
    storageBucket: "rd-portal-awagarh-be498.firebasestorage.app",
    messagingSenderId: "687919907232",
    appId: "1:687919907232:web:efbdf568831b33a16f24c5"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 1. Wrap the logic in an async function
async function loadDashboardData() {
    const mobile = localStorage.getItem("login_mobile");

    // Check for login (Good practice!)
    if (!mobile) {
        alert("Session expired or not logged in. Redirecting...");
        window.location.href = "login.html";
        return; // Stop execution
    }

    const ref = doc(db, "customer", mobile);
    
    try {
        // 2. Await the document retrieval inside the async function
        const snap = await getDoc(ref);

        if (snap.exists()) {
            let d = snap.data();
            
            // Log data to console for easy debugging
            console.log("Customer Data Retrieved:", d);

            // 3. Update the UI with data
            document.getElementById("name").innerText = d.name || "N/A"; // Use || "N/A" for safety
            document.getElementById("mobile").innerText = mobile;
            document.getElementById("start_date").innerText = d.start_date || "N/A";
            document.getElementById("maturity_date").innerText = d.maturity_date || "N/A";
            document.getElementById("amount").innerText = d.amount || 0;
            document.getElementById("total").innerText = d.total_deposited || 0;
            document.getElementById("remaining").innerText = d.remaining || 0;
            document.getElementById("maturity_amount").innerText = d.maturity_amount || 0;
        } else {
            console.error("Document not found for mobile:", mobile);
            alert("Customer details not found in the database. Please check the mobile number.");
        }
    } catch (error) {
        console.error("Error fetching dashboard data:", error);
        alert("An error occurred while loading your details.");
    }
}

// 4. Immediately call the async function
loadDashboardData();

</script>
</body>
</html>
